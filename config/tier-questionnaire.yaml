# config/tier-questionnaire.yaml
# Decision tree questions to help users determine their data tier

# Introduction shown before questions
intro:
  title: "What type of data will you be working with?"
  description: |
    Answer a few questions to help us recommend the right security level
    for your research data. If you're unsure, err on the side of caution -
    you can always adjust later with our team.
  audience_note:
    title: "Who needs this questionnaire?"
    description: |
      **This applies to you if your research involves:**
      - Human subjects (surveys, interviews, health records, genetic data)
      - Biological samples (human, animal, or plant-derived)
      - Government-controlled or export-restricted data (CUI, ITAR, EAR)
      - Industry partnerships with data use agreements
      - Student records (FERPA-protected)

      **You can likely skip this if:**
      - You work purely with simulations, models, or computational data
      - Your data is already publicly available (published datasets, open source)
      - You study physical phenomena without biological or human components
      - Your research generates no sensitive intellectual property

      *Most engineering, physics, mathematics, and computer science research
      without external data agreements falls into our standard tier (L1).*
  skip_option:
    enabled: true
    label: "I already know my data tier"
    link: "/tier-select"
  quick_select:
    enabled: true
    label: "My data is not sensitive - use standard tier"
    tier: "low"

# Questions in order
questions:
  - id: human_subjects
    question: "Does your research involve human subjects?"
    help_text: "This includes surveys, interviews, medical records, genetic data, or any data collected from people."
    icon: "users"
    options:
      - label: "No"
        value: false
        next: biological_samples
      - label: "Yes"
        value: true
        next: health_data

  - id: biological_samples
    question: "Does your research involve biological samples or genetic/genomic data?"
    help_text: "DNA, RNA, tissue samples, cell cultures, or other biological materials - from any organism."
    icon: "dna"
    options:
      - label: "No"
        value: false
        next: government_data
      - label: "Yes"
        value: true
        next: organism_source

  - id: organism_source
    question: "What is the source of your biological samples or genetic data?"
    help_text: "Select the primary organism type. If working with multiple types, select the most sensitive."
    icon: "microscope"
    learn_more:
      title: "Why does organism source matter?"
      content: |
        Different organisms have different data protection requirements:

        **Human-derived materials** - Even without an IRB protocol, human DNA/tissue
        can potentially re-identify individuals. Requires careful handling.

        **Model organisms** (mice, rats, zebrafish, fruit flies, C. elegans, yeast) -
        Generally low sensitivity. Standard research data practices apply.

        **Wildlife and field samples** - May have location sensitivity (endangered
        species, poaching concerns) or permit requirements.

        **Agricultural/livestock** - May have proprietary breeding data or
        biosecurity considerations.
    options:
      - label: "Human-derived (tissue, cell lines, DNA/RNA)"
        value: "human"
        next: human_samples_detail
      - label: "Model organisms (mouse, rat, zebrafish, fly, worm, yeast)"
        value: "model_organism"
        sets_tier: low
        next: government_data
      - label: "Wildlife, field samples, or endangered species"
        value: "wildlife"
        next: wildlife_sensitivity
      - label: "Agricultural, livestock, or plants"
        value: "agricultural"
        next: agricultural_sensitivity

  - id: human_samples_detail
    question: "What type of human-derived samples are you working with?"
    help_text: "This helps determine if re-identification risk applies."
    icon: "user-scan"
    learn_more:
      title: "Re-identification risk in genomics"
      content: |
        Human genomic data presents unique re-identification challenges:

        **High risk** - Whole genome/exome sequences, large SNP panels, or any
        genetic data that could uniquely identify an individual or their relatives.

        **Moderate risk** - Targeted sequencing, specific gene panels, or data
        linked to demographic information.

        **Lower risk** - Immortalized cell lines (HeLa, HEK293), ancient DNA,
        or fully de-identified samples from commercial biobanks with proper
        consent documentation.

        When in doubt, treat as identifiable - it's easier to reclassify down
        than to contain a breach.
      link:
        label: "Check your data's identification status →"
        action: "open_calculator"
        calculator: "data-identification"
    options:
      - label: "Research participant samples (with consent/IRB)"
        value: "participant_samples"
        sets_tier: high
        sets_flags:
          - human_genomic
        next: government_data
      - label: "Biobank samples (commercial or repository)"
        value: "biobank"
        next: biobank_consent
      - label: "Immortalized cell lines (HeLa, HEK293, etc.)"
        value: "cell_lines"
        sets_tier: low
        next: government_data
      - label: "Ancient DNA or archaeological samples"
        value: "ancient_dna"
        sets_tier: low
        next: government_data

  - id: biobank_consent
    question: "What consent and de-identification applies to your biobank samples?"
    help_text: "Check the biobank's data use agreement or material transfer agreement."
    icon: "file-check"
    learn_more:
      title: "Coded vs. De-identified Biobank Samples"
      content: |
        **Coded samples** — The biobank can link sample IDs back to donors.
        Even if YOU don't have the key, the data is still re-identifiable
        and requires appropriate protections.

        **De-identified samples** — No linking key exists anywhere. The
        biobank has permanently destroyed or never created the link.

        Check your MTA or DUA for terms like "coded," "linked," or
        "identifiable" vs. "de-identified" or "anonymized."
      link:
        label: "Learn more about data identification →"
        action: "open_calculator"
        calculator: "data-identification"
    options:
      - label: "Fully de-identified with broad consent"
        value: "deidentified_broad"
        sets_tier: low
        next: government_data
      - label: "Coded samples (key held by biobank)"
        value: "coded"
        sets_tier: medium
        next: government_data
      - label: "Identifiable or consent restrictions apply"
        value: "identifiable"
        sets_tier: high
        sets_flags:
          - human_genomic
        next: government_data
      - label: "Not sure - need to check MTA/DUA"
        value: "unsure"
        sets_tier: high
        sets_flags:
          - human_genomic
          - needs_review
        next: government_data

  - id: wildlife_sensitivity
    question: "Does your wildlife data have location or conservation sensitivity?"
    help_text: "Endangered species locations, nesting sites, or other data that could enable poaching or harassment."
    icon: "bird"
    learn_more:
      title: "Location sensitivity in wildlife research"
      content: |
        Wildlife location data may need protection if it could:

        - Enable poaching of endangered species
        - Lead to disturbance of nesting sites
        - Compromise ongoing conservation efforts
        - Violate collection permit conditions

        Some journals and funders require location data to be obscured or
        embargoed for sensitive species.
    options:
      - label: "No - common species, no location concerns"
        value: "not_sensitive"
        sets_tier: low
        next: government_data
      - label: "Yes - endangered species or sensitive locations"
        value: "sensitive"
        sets_tier: medium
        sets_flags:
          - location_sensitive
        next: government_data
      - label: "Not sure"
        value: "unsure"
        sets_tier: medium
        next: government_data

  - id: agricultural_sensitivity
    question: "Does your agricultural/plant data involve proprietary or biosecurity concerns?"
    help_text: "Breeding programs, patented varieties, or Select Agent pathogens."
    icon: "wheat"
    options:
      - label: "No - standard research crops/livestock"
        value: "not_sensitive"
        sets_tier: low
        next: government_data
      - label: "Yes - proprietary breeding or commercial partnership"
        value: "proprietary"
        sets_tier: medium
        sets_flags:
          - proprietary
        next: government_data
      - label: "Yes - USDA Select Agent or biosecurity concern"
        value: "select_agent"
        sets_tier: restricted
        sets_flags:
          - select_agent
          - biosecurity
        next: complete

  - id: health_data
    question: "Does your data include health or medical information?"
    help_text: "Medical records, diagnoses, treatments, genetic information linked to individuals, mental health data, substance abuse records."
    icon: "heart-pulse"
    options:
      - label: "No"
        value: false
        next: student_data
      - label: "Yes"
        value: true
        sets_tier: high
        sets_flags:
          - hipaa
          - phi
        next: identifiable

  - id: identifiable
    question: "Is the health data identifiable or de-identified?"
    help_text: "De-identified means all 18 HIPAA identifiers have been removed AND no linking key exists."
    icon: "user-check"
    learn_more:
      title: "Identified vs. Encoded vs. De-identified"
      content: |
        **Common confusion:** Replacing names with codes is NOT de-identification
        if you keep a linking key (even in a separate file).

        - **Identified** — Contains names, SSNs, etc. directly
        - **Encoded** — Codes instead of names, but a key exists somewhere
        - **De-identified** — No identifiers AND no way to link back

        As long as a linking key exists anywhere (Excel file, database, paper
        list, collaborator's copy), the data can be re-identified.
      link:
        label: "Help me figure out my data's status →"
        action: "open_calculator"
        calculator: "data-identification"
    options:
      - label: "Fully de-identified (Safe Harbor, no linking key)"
        value: "deidentified"
        sets_tier: medium
        clears_flags:
          - hipaa
          - phi
        next: government_data
      - label: "Encoded (codes with a linking key somewhere)"
        value: "encoded"
        sets_tier: high
        next: government_data
      - label: "Limited dataset (some identifiers remain)"
        value: "limited"
        sets_tier: high
        next: government_data
      - label: "Identifiable (names, SSNs, etc. in the data)"
        value: "identifiable"
        sets_tier: high
        next: government_data

  - id: student_data
    question: "Does your data include student education records?"
    help_text: "Grades, enrollment status, financial aid, disciplinary records, or other data from student information systems."
    icon: "graduation-cap"
    options:
      - label: "No"
        value: false
        next: government_data
      - label: "Yes"
        value: true
        sets_tier: high
        sets_flags:
          - ferpa
        next: government_data

  - id: government_data
    question: "Is this research funded by or for a government agency?"
    help_text: "DoD, DoE, NASA, or other federal contracts may have specific data handling requirements."
    icon: "landmark"
    options:
      - label: "No"
        value: false
        next: export_control
      - label: "Yes - standard federal grant (NSF, NIH)"
        value: "standard_federal"
        next: export_control
      - label: "Yes - DoD/defense-related"
        value: "dod"
        sets_flags:
          - cui_possible
        next: cui_check

  - id: cui_check
    question: "Does your contract specify CUI (Controlled Unclassified Information)?"
    help_text: "Check your contract for terms like 'CUI', 'DFARS 252.204-7012', or 'NIST 800-171'."
    icon: "file-lock"
    learn_more:
      title: "What is CUI?"
      content: |
        Controlled Unclassified Information (CUI) is government-created or
        government-owned information that requires safeguarding. Look for:

        - "CUI" marking on documents
        - Contract clause DFARS 252.204-7012
        - References to NIST SP 800-171
        - Terms like "Controlled Technical Information"

        If unsure, contact your contracting officer or our export control office.
    options:
      - label: "No / Not sure"
        value: false
        next: export_control
      - label: "Yes"
        value: true
        sets_tier: restricted
        sets_flags:
          - cui
          - nist_800_171
        next: complete

  - id: export_control
    question: "Does your research involve export-controlled technology?"
    help_text: "ITAR (defense articles), EAR (dual-use technology), or technology that cannot be shared with non-US persons."
    icon: "globe-lock"
    learn_more:
      title: "Export Control Basics"
      content: |
        Export control laws restrict sharing certain technology with non-US
        persons. This applies even to verbal discussions, not just physical
        exports.

        **ITAR** - International Traffic in Arms Regulations
        - Covers defense articles and technical data
        - Very restrictive, US persons only

        **EAR** - Export Administration Regulations
        - Covers dual-use commercial items
        - Less restrictive but still requires compliance

        Contact our Export Control office if you're unsure.
    options:
      - label: "No / Not sure"
        value: false
        next: proprietary_check
      - label: "Yes - ITAR"
        value: "itar"
        sets_tier: restricted
        sets_flags:
          - itar
        next: complete
      - label: "Yes - EAR"
        value: "ear"
        sets_tier: restricted
        sets_flags:
          - ear
        next: complete

  - id: proprietary_check
    question: "Does your research involve proprietary or confidential data?"
    help_text: "Industry partnerships with NDAs, proprietary algorithms, trade secrets, or data you've agreed to keep confidential."
    icon: "lock"
    options:
      - label: "No - publicly shareable"
        value: false
        sets_tier: low
        next: complete
      - label: "Yes - pre-publication or NDA-protected"
        value: true
        sets_tier: medium
        next: complete

  - id: complete
    type: "summary"

# Summary page configuration
summary:
  title: "Your Recommended Data Tier"
  show_flags: true
  show_reasoning: true

  # Call-to-action based on tier (keys match tier slugs from tiers.yaml)
  cta:
    low:
      title: "You're ready to go!"
      message: "Self-service access available for low-tier data."
      action: "Continue to Service Selection"
    medium:
      title: "You're ready to go!"
      message: "Self-service access available for medium-tier data."
      action: "Continue to Service Selection"
    high:
      title: "Consultation recommended"
      message: "High-tier data requires verification. We'll walk you through it."
      action: "Continue to Service Selection"
      secondary_action: "Schedule Consultation First"
    restricted:
      title: "Consultation required"
      message: "Restricted data requires export control review before proceeding."
      action: "Schedule Consultation"
      secondary_action: "Continue Planning (Preliminary)"

# Discipline-specific examples to help users understand
# Keys under 'examples' must match tier slugs from tiers.yaml (low, medium, high, restricted)
examples_by_discipline:
  biomedical:
    name: "Biomedical / Life Sciences"
    icon: "microscope"
    examples:
      low:
        - "Published protein structures from PDB"
        - "Public genomics datasets from NCBI (1000 Genomes, GTEx)"
        - "Immortalized cell line data (HeLa, HEK293)"
        - "Mouse/rat model organism sequencing"
        - "Zebrafish, C. elegans, Drosophila data"
        - "Yeast genomics and proteomics"
        - "Ancient DNA or archaeological samples"
        - "Fully de-identified biobank samples with broad consent"
      medium:
        - "Your lab's unpublished experimental results"
        - "Pre-publication manuscripts and figures"
        - "Proprietary analysis pipelines"
        - "Coded biobank samples (key held by repository)"
        - "Wildlife data with location sensitivity"
        - "Endangered species genetic data"
      high:
        - "Patient samples with clinical data"
        - "Human genetic data linked to individuals"
        - "Human whole genome/exome sequencing"
        - "Research participant samples (even with consent)"
        - "Biobank samples with consent restrictions"
        - "Clinical trial data"
        - "dbGaP controlled-access data"

  genomics:
    name: "Genomics & Bioinformatics"
    icon: "dna"
    examples:
      low:
        - "Reference genomes (GRCh38, mm10, etc.)"
        - "Model organism sequencing (mouse, fly, worm, yeast)"
        - "Public repositories (SRA, ENA, DDBJ)"
        - "Cell line genomics (CCLE, DepMap)"
        - "Microbial/viral genomes"
        - "Plant genomics (non-proprietary)"
      medium:
        - "Unpublished sequencing data (non-human)"
        - "Proprietary breeding program data"
        - "Coded human samples from repositories"
        - "Pre-publication analysis results"
      high:
        - "Human WGS/WES with individual identifiers"
        - "Patient tumor sequencing"
        - "Genetic data linked to phenotype/clinical"
        - "dbGaP or controlled-access datasets"
        - "Research participant samples"

  engineering:
    name: "Engineering"
    icon: "cog"
    examples:
      low:
        - "Published simulation results"
        - "Open-source CAD models"
        - "Public benchmark datasets"
      medium:
        - "Proprietary designs before patent filing"
        - "Industry collaboration data under NDA"
        - "Unpublished experimental results"
      restricted:
        - "Defense contractor research (ITAR)"
        - "CUI-marked government data"
        - "Export-controlled technology"

  social_science:
    name: "Social Sciences"
    icon: "users"
    examples:
      low:
        - "Census data and public surveys"
        - "Published interview transcripts"
        - "Aggregated demographic data"
      medium:
        - "Ongoing survey responses (anonymized)"
        - "Interview recordings (consent obtained)"
        - "Unpublished qualitative data"
      high:
        - "Student educational records (FERPA)"
        - "Identifiable interview data"
        - "Sensitive survey responses"

  humanities:
    name: "Humanities & Arts"
    icon: "book"
    examples:
      low:
        - "Public domain texts and images"
        - "Published research materials"
        - "Open-access archives"
      medium:
        - "Unpublished manuscripts"
        - "Licensed digital collections"
        - "Pre-publication analyses"

  physical_science:
    name: "Physical Sciences"
    icon: "atom"
    examples:
      low:
        - "Published simulation data"
        - "Public astronomy observations"
        - "Open datasets from collaborations"
      medium:
        - "Unpublished experimental results"
        - "Proprietary instrument data"
        - "Pre-publication findings"

# Allow users to override the recommendation
override:
  enabled: true
  confirmation_required: true
  confirmation_text: |
    You're selecting a different tier than our recommendation.
    Please confirm you understand the implications:

    - **Selecting a lower tier** may mean your data isn't adequately protected
    - **Selecting a higher tier** will require additional approval steps

    If you're unsure, please contact Research Computing for guidance.

# Quick-select option for experienced users
quick_select:
  enabled: true
  title: "I know my data tier"
  description: "Skip the questionnaire if you already know your classification"
  show_examples: true
